!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Forceify=t()}(this,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r=[],i={},n=Date.now(),d="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:function(e){return setTimeout(function(){return e(Date.now()-n)},50)},v="undefined"!=typeof cancelAnimationFrame?cancelAnimationFrame:function(e){return clearTimeout(e)};"object"!==("undefined"==typeof performance?"undefined":t(performance))||performance.now||(performance.now=function(){return Date.now()-n});var a=function(){return"undefined"!=typeof performance&&performance.now?performance.now():Date.now()-n},m="undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof exports?exports:this;d(function e(t){d(e);for(var n=0;n<r.length;){r[n].update(t)?n++:r.splice(n,1)}});var u=function(e,t){return null==e?t:e},s=0,c=function(){function e(e,t,n){this._queueID=e,this._onUpdate=null,this._duration=200,this._delayTime=0,this._startTime=null,this._id=s++,this.startValue=0,this.currentValue={force:0,target:t},this.__self=n,this.endValue=1,this.callElem=t}var t=e.prototype;return t.duration=function(e){return this._duration=e,this},t.start=function(){var e=this._queueID,t=(this._delayTime,this.currentValue),n=i[e];if(n)for(var o;o=n.shift();){-1<r.indexOf(o)&&r.splice(0,1)}else n=i[e]=[];return this.startValue=t.force,this.endValue=1,n.push(this),r.push(this),this._startTime=a()+this._delayTime,this},t.delay=function(e){return this._delayTime=e,this},t.onUpdate=function(e){return this._onUpdate=e,this},t.restart=function(e){this._queueID;var t=this._delayTime,n=this.currentValue;return-1===r.indexOf(this)?this.start():this._startTime=a()+t,e&&(this.startValue=n.force,this.endValue=0),this},t.update=function(e){var t=this._startTime,n=this._duration,o=this._onUpdate,r=this.currentValue,i=this.startValue,a=this.endValue,u=this.callElem,s=this.__self;if(e<t)return!0;var c=(e-t)/n;return c=1<c?1:c,r.force=void 0!==s.__force&&0!==s.__force&&1!==s.__force?s.__force:i+(a-i)*c,o&&o.call(u,r),1!==c},e}(),e="undefined"!=typeof navigator?navigator:{userAgent:"",maxTouchPoints:0,msMaxTouchPoints:0},l=e.userAgent,f=-1!==l.indexOf("; CPU")&&-1!==l.indexOf(" like Mac"),h=m.document?m.document:{},_=h.body&&"ontouchend"in h.body||m.DocumentTouch||0<e.maxTouchPoints||0<e.msMaxTouchPoints,p=h.body&&"ontouchforcechange"in h.body&&f,y=function(e,t,n){var o=n?e.touches:e.changedTouches;if(o){var r=0,i=o.length;if(1<i&&e.scale&&1!==e.scale)return null;for(e&&e.preventDefault&&e.preventDefault();r<i;){if(o[r]&&o[r].target===t)return o[r];r++}}return null};return function(){function e(e,t){var h=this;void 0===t&&(t={}),o(o(o(o(o(o(o(o(o(o(o(o(o(o(o(this,"getEnv",function(){return h._checkResult}),"resetOnLeave",function(e){return void 0===e&&(e=!0),h._resetOnLeave=e,h}),"useLongPressEqualDuration",function(e){return void 0===e&&(e=!0),h._useSameDurInLeave=e,h}),"setLongPressLeaveTolerance",function(e){return h._leaveDurationTolerance=e,h._leaveDuration=h._pressDuration*e,h}),"setLongPressDelay",function(e){return h._delay=e,h}),"setLongPressDuration",function(e){return h._pressDuration=e,h._leaveDuration=e*h._leaveDurationTolerance,h}),"onForce",function(e){return h._callback=e,h.init()}),"on",function(e,t,n){return m.addEventListener?h.el.addEventListener(e,t,n):m.attachEvent?h.el.attachEvent("on"+e,t):h.el["on"+e]=t,h}),"off",function(e,t,n){return m.removeEventListener?h.el.removeEventListener(e,t,n):m.detachEvent?h.el.detachEvent("on"+e,t):h.el["on"+e]=null,h}),"preventTouchCallout",function(){for(var e=h.el,t=["webkitTouchCallout","MozTouchCallout","msTouchCallout","khtmlUserSelect","touchCallout","webkitUserSelect","MozUserSelect","msUserSelect","khtmlUserSelect","userSelect","webkitUserDrag","MozUserDrag","msUserDrag","khtmlUserDrag","userDrag"],n=0;n<t.length;n++){var o=t[n];o in e.style&&(e.style[o]="none")}for(var r=["webkitTouchAction","mozTouchAction","msTouchAction","khtmlTouchAction","touchAction"],i=0;i<r.length;i++){var a=r[i];a in e.style&&(e.style[a]="manipulation")}return h}),"handleForceChange",function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),h._iterateOfHandleForceChange++;var t=void 0!==e.webkitForce?e.webkitForce/3:void 0!==e.force?e.force:void 0;if(void 0===t){var n=y(e,h.el,!0);n?void 0!==n.force?t=n.force:n.webkitForce&&(t=n.force):t=0}return e.force=t,h.__force=t,h._calledTimeout=!0,h._callback.call(h,e),!1}),"init",function(){var r,i,a,e=h.el,n=h.polyfill,t="onpointerdown"in e,u=h;h._iterateOfHandleForceChange=0;var s=function e(t){var n=h.__force,o=(1-Math.min((t-i)/h._leaveDuration,1))*n;0<o?r=d(e):0===o&&v(r),a.force=o,h.__force=o,h.handleForceChange(a)};if(h.preventTouchCallout(),"onwebkitmouseforcebegin"in e){var o,c=0;return h.on("onwebkitmouseforcechange",h.handleForceChange),h.on("onwebkitmouseforcebegin",function e(t){c++,clearTimeout(o),o=setTimeout(function(){u.off("onwebkitmouseforcebegin",e)},25)}),h.on("mousedown",function e(t){clearTimeout(o),o=setTimeout(function(){0===c&&0===u._iterateOfHandleForceChange&&n&&(p=!1,u._eventPress="mousedown",u._eventLeave="mouseleave",u._eventUp="mouseup",u._checkResult=m.chrome?"macOS Chrome":"macOS Safari",u.isPressed=!0,u.handleSimulate(),u.handlePress()),u.off("mousedown",e)},50)}),h.on("mouseup",function e(t){var n=u.__force,o=u._iterateOfHandleForceChange;a=t,0<n&&1<o?(i=performance.now(),r=d(s)):u.off("mouseup",e)}),h._checkResult="macOSForce",h}if(p){var l,f=0;return h.on("touchforcechange",h.handleForceChange),h.on("touchforcebegin",function e(t){f++,clearTimeout(l),l=setTimeout(function(){u.off("touchforcebegin",e)},25)}),h.on("touchstart",function e(t){clearTimeout(l),l=setTimeout(function(){0===f&&0===u._iterateOfHandleForceChange&&n&&(p=!1,u._eventPress="touchstart",u._eventLeave="touchleave",u._eventUp="touchend",u._checkResult=m.chrome?"ChromeMobile":"Touch",u.isPressed=!0,u.handleSimulate(),u.handlePress()),u.off("touchstart",e)},50)}),h.on("touchend",function e(t){var n=u.__force,o=u._iterateOfHandleForceChange;a=t,0<n&&1<o?(i=performance.now(),r=d(s)):u.off("touchend",e)}),h._checkResult="iOSForce",h}return n&&t?(h._eventPress="pointerdown",h._eventLeave="pointerleave",h._eventUp="pointerup",h._checkResult=m.chrome?"Chrome":"Modern"):n&&"onmspointerdown"in e?(h._eventPress="mspointerdown",h._eventLeave="mspointerleave",h._eventUp="mspointerup",h._checkResult=m.chrome?"Chrome":"Modern"):n&&_?(h._eventPress="touchstart",h._eventLeave="touchleave",h._eventUp="touchend",h._checkResult=m.chrome?"ChromeMobile":"Touch"):n&&"onmousedown"in e&&(h._eventPress="mousedown",h._eventLeave="mouseup",h._eventUp="mouseleave",h._checkResult=m.chrome?"Chrome":"Desktop"),h.isPressed=!1,h.handleSimulate()}),"handleLeave",function(){var e=h._simulatedCallback,t=h._useSameDurInLeave,n=h._pressDuration,o=h._leaveDuration;h.id,h.el;return e&&e.duration(t?n:o).delay(0).restart(!0),h}),"handlePress",function(){var e=h._simulatedCallback,t=(h._useSameDurInLeave,h._pressDuration),n=h._delay;h.id,h.el;return e&&e.duration(t).delay(n).start(),h}),"handleSimulate",function(){var e=h._simulatedCallback,t=h._eventPress,n=h._eventUp,o=h._eventLeave,r=h.isPressed,i=h._callback,a=h.id,u=h.el;e||(e=h._simulatedCallback=new c(a,u,h)),e&&e.onUpdate(i),h.on(t,function(e){return r||p||e.type===t&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),h.handlePress(),r=h.isPressed=!0),!1});var s=function(e){return r&&(e.type===n||e.type===o&&h._resetOnLeave)&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),h.handleLeave(),r=h.isPressed=!1),!1};return h.on(n,s),h.on(o,s),h});var n=0;return n=e.forceifyQueueId?e.forceifyQueueId:e.forceifyQueueId=Math.floor(Date.now()+1e3*Math.random()),this.id=n,this._callback=null,this.el=e,this._pressDuration=u(t.pressDuration,200),this._leaveDurationTolerance=u(t.leaveDurationTolerance,.35),this._leaveDuration=this._pressDuration*this._leaveDurationTolerance,this._delay=u(t.delay,0),this._eventPress=null,this._eventLeave=null,this._eventUp=null,this._checkResult=null,this._useSameDurInLeave=u(t.useSameDurInLeave,!1),this._resetOnLeave=u(t.resetOnLeave,!0),this.el=e,this.polyfill=u(t.polyfill,!0),this}var t=e.prototype;return t.isChrome=function(){return"Chrome"===this._checkResult||"ChromeMobile"===this._checkResult},t.isMacOSForceTouch=function(){return"macOSForce"===this._checkResult},t.isIOS3DTouch=function(){return"iOSForce"===this._checkResult},t.isTouch=function(){return"Touch"===this._checkResult},t.isMouse=function(){return"Desktop"===this._checkResult},e}()});